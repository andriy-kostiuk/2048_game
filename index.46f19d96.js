var t={};class e{static Statuses={IDLE:"idle",PLAYING:"playing",WIN:"win",LOSE:"lose"};constructor(t){this.initialState=t||[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.board=JSON.parse(JSON.stringify(this.initialState)),this.score=0,this.status=e.Statuses.IDLE}start(){this.status=e.Statuses.PLAYING,this.addNewTile(),this.addNewTile()}restart(){this.score=0,this.status=e.Statuses.IDLE,this.board=JSON.parse(JSON.stringify(this.initialState))}moveLeft(){this.move(()=>{for(let t=0;t<4;t++){let e=this.board[t].filter(t=>0!==t);e=this.mergeTiles(e),e=this.addTrailingZeros(e),this.board[t]=e}})}moveRight(){this.move(()=>{for(let t=0;t<4;t++){let e=this.board[t].filter(t=>0!==t);e=this.mergeTiles(e.reverse()),e=this.addTrailingZeros(e).reverse(),this.board[t]=e}})}moveUp(){this.move(()=>{for(let t=0;t<4;t++){let e=[];for(let s=0;s<4;s++)e.push(this.board[s][t]);e=e.filter(t=>0!==t),e=this.mergeTiles(e),e=this.addTrailingZeros(e);for(let s=0;s<4;s++)this.board[s][t]=e[s]}})}moveDown(){this.move(()=>{for(let t=0;t<4;t++){let e=[];for(let s=0;s<4;s++)e.push(this.board[s][t]);e=e.filter(t=>0!==t),e=this.mergeTiles(e.reverse()),e=this.addTrailingZeros(e).reverse();for(let s=0;s<4;s++)this.board[s][t]=e[s]}})}getScore(){return this.score}getState(){return this.board}getStatus(){return this.status}mergeTiles(t){let e=[];for(let s=0;s<t.length;s++)t[s]===t[s+1]?(e.push(2*t[s]),this.score+=2*t[s],s++):e.push(t[s]);return e}addNewTile(){let t=this.board.reduce((t,e,s)=>(e.forEach((e,r)=>{0===e&&t.push({row:s,col:r})}),t),[]);if(0===t.length)return;let e=Math.floor(Math.random()*t.length),{row:s,col:r}=t[e],a=.1>Math.random()?4:2;this.board[s][r]=a}addTrailingZeros(t){let e=t.slice();for(;e.length<4;)e.push(0);return e}updateStatus(){let t=!1;for(let s=0;s<4;s++)for(let r=0;r<4;r++){let a=this.board[s][r];if(2048===a){this.status=e.Statuses.WIN;return}0===a&&(t=!0),r<3&&a===this.board[s][r+1]&&(t=!0),s<3&&a===this.board[s+1][r]&&(t=!0)}this.status=t?e.Statuses.PLAYING:e.Statuses.LOSE}move(t){if(this.status!==e.Statuses.PLAYING)return;let s=JSON.stringify(this.board);t(),s!==JSON.stringify(this.board)&&(this.addNewTile(),this.updateStatus())}}t=e;var s={};const r="field-cell",a="hidden";var i=(s={updateCells:function(t,e){let s=t.getState();Array.from(e).forEach((t,e)=>{for(let a=0;a<4;a++){let i=+s[e][a],o=t.children[a];o.textContent=i||"",o.classList="",o.classList.add(r),i&&o.classList.add(`${r}--${i}`)}})},updateScore:function(t,e,s){let r=t.getScore(),a=Number(e.textContent),i=Number(s.textContent);if(e.textContent=r,r>a){let t=r-a;e.style.setProperty("--score-diffeerence",`"+${t}"`),e.classList.remove("game-score--animate"),e.offsetWidth,e.classList.add("game-score--animate")}r>i&&(s.textContent=r,localStorage.setItem("best",r))},updateStatus:function(e,s){let[r,i,o]=s,l=e.getStatus();switch(Array.from(s).forEach(t=>{t.classList.add(a)}),l){case t.Statuses.IDLE:o.classList.remove(a);break;case t.Statuses.WIN:i.classList.remove(a);break;case t.Statuses.LOSE:r.classList.remove(a)}}}).updateCells,o=s.updateScore,l=s.updateStatus;const n=new t,d=document.querySelector(".start"),c=document.querySelectorAll(".field-row"),h=document.querySelector(".game-score"),u=document.querySelector(".game-best"),f=document.querySelector(".message-container").children,S=localStorage.getItem("best");function m(){i(n,c),o(n,h,u),l(n,f)}S&&(u.textContent=S),document.addEventListener("keydown",e=>{if(n.getStatus()===t.Statuses.PLAYING){switch(e.key){case"ArrowUp":n.moveUp();break;case"ArrowDown":n.moveDown();break;case"ArrowLeft":n.moveLeft();break;case"ArrowRight":n.moveRight();break;default:return}m()}}),d.addEventListener("click",()=>{d.classList.contains("start")?(n.start(),d.classList.replace("start","restart"),d.textContent="Restart"):d.classList.contains("restart")&&(n.restart(),d.classList.replace("restart","start"),d.textContent="Start"),m()});
//# sourceMappingURL=index.46f19d96.js.map
